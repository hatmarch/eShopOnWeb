apiVersion: 1.0.0
metadata:
  name: dotnet-eshop
projects:
  - name: eShopOnWeb
    source:
      location: 'https://gitea.az-demo-support.svc.cluster.local:3000/gitea/eShopOnWeb.git'
      type: github
      branch: feature-fmg
components:
  - id: redhat-developer/che-omnisharp-plugin/latest
    memoryLimit: 1024Mi
    type: chePlugin
    alias: omnisharp
  - id: redhat-developer/netcoredbg-theia-plugin/latest
    memoryLimit: 512Mi
    type: chePlugin
    alias: netcoredbg
  - mountSources: true
    endpoints:
      - name: hello-endpoint
        port: 5000
    memoryLimit: 512Mi
    type: dockerimage
    volumes:
      - name: nuget
        containerPath: /home/jboss/.nuget
    alias: dotnet
    image: 'quay.io/mhildenb/az-demo-shell:latest'
commands:
  - name: 1. Update dependencies
    actions:
      - workdir: '${CHE_PROJECTS_ROOT}/eShopOnWeb/src/Web'
        type: exec
        command: dotnet restore
        component: dotnet
  - name: 2. Build
    actions:
      - workdir: '${CHE_PROJECTS_ROOT}/eShopOnWeb/src/Web'
        type: exec
        command: dotnet build
        component: dotnet
  - name: 3. Run
    actions:
      - workdir: '${CHE_PROJECTS_ROOT}/eShopOnWeb/src/Web'
        type: exec
        command: dotnet run
        component: dotnet
  - name: Launch .net web application in debug mode
    actions:
      - referenceContent: |
          {
            "version": "0.2.0",
              "configurations": [
                 {
                    "type": "netcoredbg",
                    "request": "launch",
                    "name": ".NET Core Launch (console)",
                    "stopAtEntry": true,
                    "preLaunchTask": "build",
                    "console": "internalConsole",
                    "preLaunchTask": "build",
                    // If you have changed target frameworks, make sure to update the program path.
                    "program": "/projects/eShopOnWeb/src/Web/bin/Debug/netcoreapp3.1/Web.dll",
                    "args": [],
                    "cwd": "/projects/eShopOnWeb/src/Web",
                    "stopAtEntry": false,
                    // Enable launching a web browser when ASP.NET Core starts. For more information: https://aka.ms/VSCode-CS-LaunchJson-WebBrowser
                    "serverReadyAction": {
                        "action": "openExternally",
                        "pattern": "^\\s*Now listening on:\\s+(https?://\\S+)"
                    },
                    "envFile": "/home/jboss/.zshenv",
                    "sourceFileMap": {
                        "/Views": "projects/eShopOnWeb/Views"
                    }

                  }
              ]
          }
        type: vscode-launch
